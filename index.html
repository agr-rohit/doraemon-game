<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<title>Doraemon Catch the Cake!</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">

<style>
  :root {
    --dora-blue: #0096D9;
    --dora-red: #E50012;
    --dora-yellow: #F9E000;
    --dora-white: #FFFFFF;
    --dora-scale: 1;
    --parallax-speed: 60s;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    height: 100vh;
    overflow: hidden;
    background: #87CEEB;
    font-family: 'Fredoka One', cursive;
  }

  /* Parallax Background */
  @keyframes skyScroll {
    from { background-position: 0 0; }
    to { background-position: 1000px 0; }
  }

  #game {
    position: relative;
    width: 100%;
    height: 100%;
    background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%);
    background-image: url('background.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: repeat-x;
    animation: skyScroll var(--parallax-speed) linear infinite;
    touch-action: none;
    overflow: hidden;
  }

  /* --- ANIMATIONS --- */
  @keyframes gulp {
    0% { transform: translateX(-50%) scaleX(var(--dora-scale)) scaleY(1); }
    50% { transform: translateX(-50%) scaleX(calc(var(--dora-scale) * 1.2)) scaleY(1.2) translateY(-15px); }
    100% { transform: translateX(-50%) scaleX(var(--dora-scale)) scaleY(1); }
  }
  .eating { animation: gulp 0.3s ease-in-out; }

  /* Golden Glow (Aura) */
  @keyframes auraFlash {
    0% { filter: drop-shadow(0 0 0px var(--dora-yellow)); }
    50% { filter: drop-shadow(0 0 25px var(--dora-yellow)) brightness(1.2); }
    100% { filter: drop-shadow(0 0 0px var(--dora-yellow)); }
  }
  .super-catch { animation: auraFlash 0.5s ease-out; }

  /* Particles (Heart Burst) */
  .particle {
    position: absolute;
    pointer-events: none;
    font-size: 24px;
    z-index: 50;
    animation: floatUp 0.8s ease-out forwards;
  }
  @keyframes floatUp {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-100px) translateX(var(--random-x)) scale(0.5); opacity: 0; }
  }

  #score {
    position: absolute;
    top: 20px; left: 20px;
    color: var(--dora-white); font-size: 32px;
    background: rgba(0, 150, 217, 0.7);
    padding: 10px 20px; border-radius: 50px;
    border: 3px solid var(--dora-white);
    z-index: 30;
  }

  #doraemon {
    position: absolute;
    bottom: 40px;
    width: 90px; height: 90px;
    pointer-events: none;
    z-index: 10;
    transition: left 0.1s ease-out; 
    transform-origin: bottom center;
    transform: translateX(-50%) scaleX(var(--dora-scale));
  }

  .cake {
    position: absolute;
    width: 60px; height: 60px;
    pointer-events: none;
    z-index: 5;
  }

  .screen-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: opacity 0.4s;
    z-index: 100;
    color: white;
  }
  
  #startScreen { z-index: 200; }
  #gameover { opacity: 0; pointer-events: none; }

  .card {
    background: var(--dora-white);
    color: #333;
    padding: 30px;
    border-radius: 30px;
    border: 8px solid var(--dora-blue);
    text-align: center;
    width: 85%; max-width: 400px;
    box-shadow: 0 10px 0 var(--dora-red);
  }
  .card h1 { color: var(--dora-blue); font-size: 36px; margin-bottom: 10px; }
  .card p { font-size: 18px; margin-bottom: 15px; color: #666; }

  .action-btn {
    background: var(--dora-yellow);
    color: #333; border: none;
    padding: 15px 30px; font-size: 24px;
    font-family: 'Fredoka One', cursive;
    border-radius: 50px; cursor: pointer;
    box-shadow: 0 5px 0 #b7a500;
    margin-top: 5px;
  }
  .action-btn:active { transform: translateY(4px); box-shadow: 0 1px 0 #b7a500; }

  .controls { position: absolute; inset: 0; z-index: 15; }
  .side { position: absolute; width: 50%; height: 100%; top: 0; }
  #left { left: 0; } #right { right: 0; }
</style>
</head>
<body>

<div id="game">
  <div id="score">Cakes: 0</div>
  <img id="doraemon" src="doraemon.png" alt="Doraemon">

  <div class="controls">
    <div class="side" id="left"></div>
    <div class="side" id="right"></div>
  </div>

  <div id="startScreen" class="screen-overlay">
    <div class="card">
      <h1>Doraemon's Cake Chase!</h1>
      <p>Tap left or right to help Doraemon catch his favorite snack!</p>
      <button id="startBtn" class="action-btn">START GAME</button>
    </div>
  </div>

  <div id="gameover" class="screen-overlay">
    <div class="card">
      <h1>OH NO!</h1>
      <p>Doraemon missed a cake!</p>
      <div id="finalScore" style="font-size: 32px; margin: 15px 0; color: var(--dora-red);">Score: 0</div>
      <button class="action-btn" onclick="location.reload()">RESTART</button>
    </div>
  </div>
</div>

<script>
// --- AUDIO ENGINE (No files needed!) ---
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(type) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  
  if(type === 'pop') {
    osc.type = 'sine';
    osc.frequency.setValueAtTime(400, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
    gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
    osc.start(); osc.stop(audioCtx.currentTime + 0.1);
  } else if(type === 'sparkle') {
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(800, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.2);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.2);
    osc.start(); osc.stop(audioCtx.currentTime + 0.2);
  }
}

// --- GAME LOGIC ---
const game = document.getElementById('game');
const doraemon = document.getElementById('doraemon');
const scoreEl = document.getElementById('score');
const gameoverEl = document.getElementById('gameover');
const finalScoreEl = document.getElementById('finalScore');
const startScreenEl = document.getElementById('startScreen');
const startBtn = document.getElementById('startBtn');

let score = 0;
let gameActive = false; 
let cakes = [];
let doraemonX = window.innerWidth / 2;
let facingScale = 1;
let currentFallingSpeed = 5;
let spawnRate = 1200;
let spawnInterval;

startBtn.addEventListener('click', () => {
  if (audioCtx.state === 'suspended') audioCtx.resume();
  startGame();
});

function startGame() {
    gameActive = true;
    startScreenEl.style.opacity = '0';
    setTimeout(() => { startScreenEl.style.display = 'none'; }, 400);
    spawnInterval = setInterval(spawnCake, spawnRate);
    gameLoop();
}

function spawnParticles(count, isSuper) {
  const dRect = doraemon.getBoundingClientRect();
  for(let i=0; i<count; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.innerText = isSuper ? '⭐' : '❤️';
    p.style.left = (dRect.left + dRect.width/2) + 'px';
    p.style.top = dRect.top + 'px';
    p.style.setProperty('--random-x', (Math.random() * 100 - 50) + 'px');
    game.appendChild(p);
    setTimeout(() => p.remove(), 800);
  }
}

function spawnCake() {
  if (!gameActive) return;
  const cake = document.createElement('img');
  cake.src = 'cake.png?' + new Date().getTime(); 
  cake.className = 'cake';
  const startX = Math.random() * (game.clientWidth - 60) + 30;
  cake.style.left = startX + 'px';
  cake.currentY = -70; 
  game.appendChild(cake);
  cakes.push(cake);
}

function gameLoop() {
  if (gameActive) {
    for (let i = cakes.length - 1; i >= 0; i--) {
      const cake = cakes[i];
      cake.currentY += currentFallingSpeed;
      cake.style.top = cake.currentY + 'px';

      const cRect = cake.getBoundingClientRect();
      const dRect = doraemon.getBoundingClientRect();

      if (cRect.bottom > dRect.top + 15 && cRect.top < dRect.bottom &&
          cRect.right > dRect.left + 15 && cRect.left < dRect.right - 15) {
        
        // CATCH LOGIC
        const isSuper = Math.random() > 0.8; // 20% chance
        doraemon.classList.add('eating');
        
        if(isSuper) {
          doraemon.classList.add('super-catch');
          playSound('sparkle');
          spawnParticles(6, true);
          setTimeout(() => doraemon.classList.remove('super-catch'), 500);
        } else {
          playSound('pop');
          spawnParticles(3, false);
        }

        score++;
        scoreEl.innerText = "Cakes: " + score;
        
        // INCREASE SPEED EVERY 10 CAKES
        if (score % 10 === 0) {
          currentFallingSpeed += 0.8;
          // Speed up parallax
          const currentSec = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--parallax-speed'));
          document.documentElement.style.setProperty('--parallax-speed', (currentSec * 0.9) + 's');
        }

        cake.remove();
        cakes.splice(i, 1);
        continue;
      }

      if (cake.currentY > game.clientHeight) endGame();
    }
  }
  requestAnimationFrame(gameLoop);
}

function endGame() {
  gameActive = false;
  clearInterval(spawnInterval);
  gameoverEl.style.opacity = '1';
  gameoverEl.style.pointerEvents = 'all';
  finalScoreEl.innerText = "Score: " + score;
}

// --- Controls ---
let moveLeft = false; let moveRight = false;
const startL = (e) => { e.preventDefault(); moveLeft = true; facingScale = 1; };
const startR = (e) => { e.preventDefault(); moveRight = true; facingScale = -1; };
const stop = () => { moveLeft = false; moveRight = false; };

document.getElementById('left').onpointerdown = startL;
document.getElementById('right').onpointerdown = startR;
window.onpointerup = stop;

window.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowLeft') { moveLeft = true; facingScale = 1; }
  if (e.key === 'ArrowRight') { moveRight = true; facingScale = -1; }
});
window.addEventListener('keyup', stop);

doraemon.addEventListener('animationend', (e) => {
    if(e.animationName === 'gulp') doraemon.classList.remove('eating');
});

setInterval(() => {
  if (!gameActive) return;
  if (moveLeft) doraemonX -= 14;
  if (moveRight) doraemonX += 14;
  
  document.documentElement.style.setProperty('--dora-scale', facingScale);
  doraemon.style.left = doraemonX + 'px';
  if (!doraemon.classList.contains('eating')) {
      doraemon.style.transform = `translateX(-50%) scaleX(${facingScale})`;
  }
}, 16);

doraemon.style.left = doraemonX + 'px';
</script>
</body>
</html>