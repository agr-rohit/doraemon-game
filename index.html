<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"/>
<title>Doraemon Catch the Cake!</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">

<style>
  :root {
    --dora-blue: #0096D9;
    --dora-red: #E50012;
    --dora-yellow: #F9E000;
    --dora-white: #FFFFFF;
    --dora-scale: 1;
    --parallax-speed: 60s;
  }
  
  * { 
    margin:0; padding:0; box-sizing:border-box; 
    -webkit-tap-highlight-color: transparent; 
    user-select: none;
  }

  body {
    height: 100svh; 
    width: 100vw;
    overflow: hidden;
    background: #000;
    font-family: 'Fredoka One', cursive;
    position: fixed;
  }

  #game {
    position: relative;
    width: 100%;
    height: calc(100svh - env(safe-area-inset-bottom));
    background: linear-gradient(to bottom, #87CEEB 0%, #E0F7FA 100%);
    background-image: url('background.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: repeat-x;
    animation: skyScroll var(--parallax-speed) linear infinite;
    touch-action: none;
    overflow: hidden;
  }

  @keyframes skyScroll {
    from { background-position: 0 0; }
    to { background-position: 1000px 0; }
  }

  #score {
    position: absolute;
    top: calc(20px + env(safe-area-inset-top)); 
    left: 20px;
    color: var(--dora-white); font-size: 26px;
    background: rgba(0, 150, 217, 0.7);
    padding: 8px 16px; border-radius: 50px;
    border: 3px solid var(--dora-white);
    z-index: 30;
  }

  #doraemon {
    position: absolute;
    bottom: calc(70px + env(safe-area-inset-bottom));
    width: 80px; height: 80px;
    pointer-events: none;
    z-index: 10;
    transform-origin: bottom center;
  }

  /* --- VISIBLE BUTTONS --- */
  .controls { position: absolute; inset: 0; z-index: 15; }
  
  .side { 
    position: absolute; 
    width: 50%; height: 100%; 
    top: 0; 
    display: flex;
    align-items: flex-end; /* Put arrows at the bottom */
    justify-content: center;
    padding-bottom: calc(40px + env(safe-area-inset-bottom));
  }
  
  #left { left: 0; } 
  #right { right: 0; }

  .arrow-hint {
    font-size: 50px;
    color: white;
    opacity: 0.9; /* Subtle and non-distracting */
    background: rgba(0, 0, 0, 0.1);
    width: 70px; height: 70px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    border: 2px solid white;
    transition: all 0.1s;
  }

  /* Pulse effect when pressed */
  .side:active .arrow-hint {
    opacity: 0.6;
    transform: scale(1.1);
    background: rgba(255, 255, 255, 0.3);
  }

  /* --- ANIMATIONS & PARTICLES --- */
  @keyframes gulp {
    0% { transform: translateX(-50%) scaleX(var(--dora-scale)) scaleY(1); }
    50% { transform: translateX(-50%) scaleX(calc(var(--dora-scale) * 1.2)) scaleY(1.2) translateY(-15px); }
    100% { transform: translateX(-50%) scaleX(var(--dora-scale)) scaleY(1); }
  }
  .eating { animation: gulp 0.3s ease-in-out; }

  @keyframes auraFlash {
    0% { filter: drop-shadow(0 0 0px var(--dora-yellow)); }
    50% { filter: drop-shadow(0 0 25px var(--dora-yellow)) brightness(1.2); }
    100% { filter: drop-shadow(0 0 0px var(--dora-yellow)); }
  }
  .super-catch { animation: auraFlash 0.5s ease-out; }

  .particle {
    position: absolute;
    pointer-events: none;
    font-size: 24px;
    z-index: 50;
    animation: floatUp 0.8s ease-out forwards;
  }
  @keyframes floatUp {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-100px) translateX(var(--random-x)) scale(0.5); opacity: 0; }
  }

  .cake {
    position: absolute;
    width: 50px; height: 50px;
    pointer-events: none;
    z-index: 5;
  }

  .screen-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 100;
    color: white;
  }
  
  #startScreen { z-index: 200; }
  #gameover { display: none; }

  .card {
    background: var(--dora-white);
    color: #333;
    padding: 30px;
    border-radius: 30px;
    border: 8px solid var(--dora-blue);
    text-align: center;
    width: 85%; max-width: 400px;
    box-shadow: 0 10px 0 var(--dora-red);
  }
  .card h1 { color: var(--dora-blue); font-size: 30px; margin-bottom: 10px; }
  .card p { font-size: 16px; margin-bottom: 15px; color: #666; }

  .action-btn {
    background: var(--dora-yellow);
    color: #333; border: none;
    padding: 12px 24px; font-size: 20px;
    font-family: 'Fredoka One', cursive;
    border-radius: 50px; cursor: pointer;
    box-shadow: 0 5px 0 #b7a500;
  }
</style>
</head>
<body>

<div id="game">
  <div id="score">Cakes: 0</div>
  <img id="doraemon" src="doraemon.png" alt="Doraemon">

  <div class="controls">
    <div class="side" id="left"><div class="arrow-hint">←</div></div>
    <div class="side" id="right"><div class="arrow-hint">→</div></div>
  </div>

  <div id="startScreen" class="screen-overlay">
    <div class="card">
      <h1>Doraemon's Cake Chase!</h1>
      <p>Tap the arrows to move.<br>Don't let cakes hit the floor!</p>
      <button id="startBtn" class="action-btn">START GAME</button>
    </div>
  </div>

  <div id="gameover" class="screen-overlay">
    <div class="card">
      <h1>OH NO!</h1>
      <p>A cake hit the ground!</p>
      <div id="finalScore" style="font-size: 32px; margin: 15px 0; color: var(--dora-red);">Score: 0</div>
      <button class="action-btn" onclick="location.reload()">RESTART</button>
    </div>
  </div>
</div>

<script>
// --- AUDIO ENGINE ---
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(type) {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  if(type === 'pop') {
    osc.type = 'sine';
    osc.frequency.setValueAtTime(400, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
    gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
    gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
    osc.start(); osc.stop(audioCtx.currentTime + 0.1);
  } else if(type === 'sparkle') {
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(800, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.2);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.2);
    osc.start(); osc.stop(audioCtx.currentTime + 0.2);
  }
}

const game = document.getElementById('game');
const doraemon = document.getElementById('doraemon');
const scoreEl = document.getElementById('score');
const gameoverEl = document.getElementById('gameover');
const finalScoreEl = document.getElementById('finalScore');
const startScreenEl = document.getElementById('startScreen');
const startBtn = document.getElementById('startBtn');

let score = 0;
let gameActive = false; 
let cakes = [];
let doraemonX = window.innerWidth / 2;
let facingScale = 1;
let currentFallingSpeed = 5;
let spawnInterval;

startBtn.addEventListener('click', () => {
  if (audioCtx.state === 'suspended') audioCtx.resume();
  gameActive = true;
  startScreenEl.style.display = 'none';
  spawnInterval = setInterval(spawnCake, 1200);
  gameLoop();
});

function spawnParticles(count, isSuper) {
  const dRect = doraemon.getBoundingClientRect();
  for(let i=0; i<count; i++) {
    const p = document.createElement('div');
    p.className = 'particle';
    p.innerText = isSuper ? '⭐' : '❤️';
    p.style.left = (dRect.left + dRect.width/2) + 'px';
    p.style.top = dRect.top + 'px';
    p.style.setProperty('--random-x', (Math.random() * 100 - 50) + 'px');
    game.appendChild(p);
    setTimeout(() => p.remove(), 800);
  }
}

function spawnCake() {
  if (!gameActive) return;
  const cake = document.createElement('img');
  cake.src = 'cake.png?' + new Date().getTime(); 
  cake.className = 'cake';
  const startX = Math.random() * (game.clientWidth - 60) + 30;
  cake.style.left = startX + 'px';
  cake.currentY = -70; 
  game.appendChild(cake);
  cakes.push(cake);
}

function gameLoop() {
  if (gameActive) {
    for (let i = cakes.length - 1; i >= 0; i--) {
      const cake = cakes[i];
      cake.currentY += currentFallingSpeed;
      cake.style.top = cake.currentY + 'px';
      const cRect = cake.getBoundingClientRect();
      const dRect = doraemon.getBoundingClientRect();

      if (cRect.bottom > dRect.top + 15 && cRect.top < dRect.bottom &&
          cRect.right > dRect.left + 15 && cRect.left < dRect.right - 15) {
        
        const isSuper = Math.random() > 0.8;
        doraemon.classList.add('eating');
        if(isSuper) {
          doraemon.classList.add('super-catch');
          playSound('sparkle'); spawnParticles(6, true);
          setTimeout(() => doraemon.classList.remove('super-catch'), 500);
        } else {
          playSound('pop'); spawnParticles(3, false);
        }
        score++;
        scoreEl.innerText = "Cakes: " + score;
        if (score % 10 === 0) {
          currentFallingSpeed += 0.8;
          const currentSec = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--parallax-speed'));
          document.documentElement.style.setProperty('--parallax-speed', (currentSec * 0.9) + 's');
        }
        cake.remove();
        cakes.splice(i, 1);
        continue;
      }
      if (cake.currentY > game.clientHeight) {
        gameActive = false;
        clearInterval(spawnInterval);
        gameoverEl.style.display = 'flex';
        gameoverEl.style.opacity = '1';
        gameoverEl.style.pointerEvents = 'all';
        finalScoreEl.innerText = "Score: " + score;
      }
    }
  }
  requestAnimationFrame(gameLoop);
}

let moveLeft = false, moveRight = false;
const stopMove = (e) => { if(e) e.preventDefault(); moveLeft = false; moveRight = false; };

const leftSide = document.getElementById('left');
const rightSide = document.getElementById('right');

leftSide.addEventListener('pointerdown', (e) => { e.preventDefault(); moveLeft = true; facingScale = 1; });
rightSide.addEventListener('pointerdown', (e) => { e.preventDefault(); moveRight = true; facingScale = -1; });
window.addEventListener('pointerup', stopMove);
window.addEventListener('pointercancel', stopMove);

window.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowLeft') { moveLeft = true; facingScale = 1; }
  if (e.key === 'ArrowRight') { moveRight = true; facingScale = -1; }
});
window.addEventListener('keyup', (e) => {
  if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') stopMove();
});

doraemon.addEventListener('animationend', (e) => {
    if(e.animationName === 'gulp') doraemon.classList.remove('eating');
});

setInterval(() => {
  if (!gameActive) return;
  const speed = 14;
  const dWidth = doraemon.offsetWidth;
  const gameWidth = game.clientWidth;
  if (moveLeft) doraemonX -= speed;
  if (moveRight) doraemonX += speed;
  if (doraemonX < dWidth/2) doraemonX = dWidth/2;
  if (doraemonX > gameWidth - dWidth/2) doraemonX = gameWidth - dWidth/2;
  
  document.documentElement.style.setProperty('--dora-scale', facingScale);
  doraemon.style.left = doraemonX + 'px';
  doraemon.style.transform = `translateX(-50%) scaleX(${facingScale})`;
}, 16);

window.addEventListener('resize', () => { 
  if(!gameActive) doraemonX = window.innerWidth / 2; 
});
</script>
</body>
</html>